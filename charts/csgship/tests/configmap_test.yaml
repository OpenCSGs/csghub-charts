suite: Test CSGShip ConfigMap
templates:
  - configmap.yaml
release:
  name: csghub
  namespace: csghub
set:
  global:
    gateway:
      external:
        domain: "example.com"
      tls:
        enabled: true
        secretName: "test-tls"
    chartContext:
      isBuiltIn: false
  externalUrl: "https://csghub.example.com"
  hubAPIToken: "239sdj32sdfii23"
  billing:
    enabled: true
    nats:
      host: "csghub-nats"
      port: 4222
      user: "natsAdmin"
      password: "natsPassword"
tests:
  - it: Should render configmap correctly
    template: configmap.yaml
    asserts:
      - equal:
          path: metadata.name
          value: "csghub-csgship"
      - equal:
          path: metadata.labels["app.kubernetes.io/service"]
          value: "csgship"
      - equal:
          path: data.CASDOOR_ENDPOINT
          value: "https://casdoor.example.com"
      - equal:
          path: data.CASDOOR_REDIRECT_URI_PATH
          value: "/api/v1/account/casdoor/login/callback/"
      - equal:
          path: data.STARSHIP_WEB_URL
          value: "https://csgship.example.com"
      - equal:
          path: data.STARSHIP_API_URL
          value: "https://csgship-api.example.com"
      - equal:
          path: data.WEB_SVC_API_BASE
          value: "http://csghub-csgship:8000"
      - equal:
          path: data.ACCOUNTING_API_BASE
          value: "https://csghub.example.com"
      - equal:
          path: data.OPENCSG_HUB_BASE_URL
          value: "https://csghub.example.com"
      - equal:
          path: data.ACCOUNTING_API_KEY
          value: "239sdj32sdfii23"
      - equal:
          path: data.OPENCSG_HUB_ACCESS_TOKEN
          value: "239sdj32sdfii23"
      - equal:
          path: data.STARSHIP_BILLING_API_BASE
          value: "http://csghub-billing:8080"
      - equal:
          path: data.BILLING_SVC_API_BASE
          value: "http://csghub-billing:8080"
      - equal:
          path: data.AGENTIC_SVC_API_BASE
          value: "http://csghub-agentic:8000"
      - equal:
          path: data.NATS_URL
          value: "nats://natsAdmin:natsPassword@csghub-nats:4222"
