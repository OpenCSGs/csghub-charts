suite: Test Runner Ingress
templates:
  - ingress.yaml
release:
  name: csghub
  namespace: csghub
set:
  global:
    ingress:
      domain: "example.cn"
      host: ""
      tls:
        enabled: true
        secretName: "example-cn-tls"
      service:
        type: "NodePort"
    chartContext:
      isBuiltIn: false
  name: "runner-svc"
  service:
    port: 8082
tests:
  - it: Should render ingress correctly
    template: ingress.yaml
    asserts:
      - contains:
          path: spec.tls[0].hosts
          content: "runner-svc.example.cn"
      - equal:
          path: spec.tls[0].secretName
          value: "example-cn-tls"
      - equal:
          path: spec.rules[0].host
          value: "runner-svc.example.cn"
      - equal:
          path: spec.rules[0].http.paths[0].backend.service.name
          value: "csghub-runner-svc"
      - equal:
          path: spec.rules[0].http.paths[0].backend.service.port.number
          value: 8082

  - it: Should render ingress correctly with local
    template: ingress.yaml
    set:
      ingress:
        tls:
          secretName: "example-cn-tls-local"
    asserts:
      - equal:
          path: spec.tls[0].secretName
          value: "example-cn-tls-local"

  - it: Should render ingress correctly
    template: ingress.yaml
    set:
      global:
        ingress:
          host: "runner.example.com"
    asserts:
      - contains:
          path: spec.tls[0].hosts
          content: "runner.example.com"
