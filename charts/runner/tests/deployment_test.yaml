suite: Test Runner Deployment
templates:
  - deployment.yaml
  - deployment-logcollector.yaml
release:
  name: runner
  namespace: csghub
set:
  global:
    image:
      registry: ""
      tag: "v1.11.0"
  image:
    registry: "docker.io"
    repository: "opencsghq/csghub-server"
    tag: "v1.11.0"
  logcollector:
    enabled: true
    loki:
      address: "https://loki.example.cn"
tests:
  - it: should render deployment correct when default
    asserts:
      - equal:
          path: spec.template.spec.serviceAccountName
          value: "runner-admin"
      - equal:
          path: spec.template.spec.containers[0].image
          value: "docker.io/opencsghq/csghub-server:v1.11.0-ee"

  - it: should render deployment correct when default
    set:
      global:
        image:
          registry: "opencsg-registry.cn-beijing.cr.aliyuncs.com"
    asserts:
      - equal:
          path: spec.template.spec.containers[0].image
          value: "opencsg-registry.cn-beijing.cr.aliyuncs.com/opencsghq/csghub-server:v1.11.0-ee"
