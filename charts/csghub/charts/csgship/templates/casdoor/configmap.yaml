{{- /*
Copyright OpenCSG, Inc. All Rights Reserved.
SPDX-License-Identifier: APACHE-2.0
*/ -}}

{{- if not .Values.global.chartContext.isBuiltIn }}
{{- $service := include "common.service" (dict "service" "casdoor" "global" .) | fromYaml }}
{{- $serviceName := include "common.names.custom" (list . $service.name) }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $serviceName }}
  namespace: {{ .Release.Namespace }}
  labels:
    app.kubernetes.io/service: {{ $service.name }}
    {{- include "common.labels" . | nindent 4 }}
data:
  app.conf: |
    appname = casdoor
    httpport = 8000
    runmode = prod
    copyrequestbody = true
    driverName = postgres
    dataSourceName = {{ include "csghub.postgresql.dsn" (dict "service" $service "global" .) | quote }}
    dbName =
    tableNamePrefix =
    showSql = false
    redisEndpoint =
    defaultStorageProvider =
    isCloudIntranet = false
    authState = "casdoor"
    socks5Proxy = "127.0.0.1:10808"
    verificationCodeTimeout = 10
    initScore = 0
    logPostOnly = true
    origin = {{ include "common.endpoint.casdoor" . | quote }}
    originFrontend =
    staticBaseUrl = "https://cdn.casbin.org"
    isDemoMode = false
    batchSize = 100
    enableGzip = true
    ldapServerPort = 389
    radiusServerPort = 1812
    radiusSecret = "secret"
    quota = {"organization": -1, "user": -1, "application": -1, "provider": -1}
    logConfig = {"filename": "/dev/stdout", "maxdays":99999, "perm":"0770"}
    initDataFile = "/conf/init_data.json"
    initDataNewOnly = true
    frontendBaseDir = "../casdoor"
  init_data.json: |
    {
      "organizations": [
        {
          "owner": "admin",
          "name": "OpenCSG",
          "displayName": "OpenCSG",
          "websiteUrl": {{ include "common.endpoint.casdoor" . | quote }},
          "favicon": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/favicon.png",
          "logo": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/logo.png",
          "passwordType": "bcrypt",
          "passwordSalt": "OpenCSG",
          "passwordOptions": [
            "AtLeast8",
            "Aa123",
            "SpecialChar"
          ],
          "countryCodes": [
            "CN",
            "US"
          ],
          "defaultAvatar": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/robot.png",
          "defaultApplication": "CSGShip",
          "tags": [],
          "languages": [
            "zh",
            "en"
          ],
          "themeData": {
            "themeType": "default",
            "colorPrimary": "#1C8B7F",
            "borderRadius": 6,
            "isCompact": false,
            "isEnabled": true
          },
          "masterPassword": "",
          "defaultPassword": "",
          "initScore": 2000,
          "enableSoftDeletion": true,
          "isProfilePublic": true,
          "mfaItems": [],
          "useEmailAsUsername": false,
          "enableTour": false,
          "accountItems": [
            {
              "name": "Organization",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Admin",
              "regex": ""
            },
            {
              "name": "ID",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Immutable",
              "regex": ""
            },
            {
              "name": "Name",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Admin",
              "regex": ""
            },
            {
              "name": "Display name",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Avatar",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "User type",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Admin",
              "regex": ""
            },
            {
              "name": "Password",
              "visible": true,
              "viewRule": "Self",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Email",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Phone",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Country/Region",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Location",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Address",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Self",
              "regex": ""
            },
            {
              "name": "Language",
              "visible": true,
              "viewRule": "Public",
              "modifyRule": "Admin",
              "regex": ""
            },
            {
              "name": "Is admin",
              "visible": true,
              "viewRule": "Admin",
              "modifyRule": "Admin",
              "regex": ""
            }
          ]
        }
      ],
      "applications": [
        {
          "owner": "admin",
          "name": "CSGShip",
          "displayName": "CSGShip",
          "logo": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/logo.png",
          "homepageUrl": {{ include "common.endpoint.web" . | quote }},
          "organization": "OpenCSG",
          "cert": "csgship-cert",
          "enablePassword": true,
          "enableSignUp": true,
          "enableSigninSession": false,
          "enableAutoSignin": false,
          "enableCodeSignin": false,
          "enableSamlCompress": false,
          "enableSamlC14n10": false,
          "enableSamlPostBinding": false,
          "enableWebAuthn": false,
          "enableLinkWithEmail": true,
          "orgChoiceMode": "Select",
          "samlReplyUrl": "",
          {{- $appCsgship := include "csghub.casdoor.client" "CSGShip" | fromYaml }}
          "clientId": {{ $appCsgship.clientId | quote }},
          "clientSecret": {{ $appCsgship.clientSecret | quote }},
          "providers": [
            {
              "owner": "",
              "name": "Email_Provider",
              "canSignUp": true,
              "canSignIn": true,
              "canUnlink": true,
              "prompted": false,
              "rule": "all"
            },
            {
              "owner": "",
              "name": "Captcha_Provider",
              "canSignUp": true,
              "canSignIn": true,
              "canUnlink": true,
              "prompted": false,
              "rule": "None"
            },
            {
              "owner": "",
              "name": "GitLab_Provider",
              "canSignUp": true,
              "canSignIn": true,
              "canUnlink": true,
              "countryCodes": null,
              "prompted": false,
              "signupGroup": "",
              "rule": "None",
              "provider": null
            }
          ],
          "signinMethods": [
            {
              "name": "Password",
              "displayName": "Password",
              "rule": "All"
            }
          ],
          "signupItems": [
            {
              "name": "ID",
              "visible": false,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "Random"
            },
            {
              "name": "Username",
              "visible": true,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "None"
            },
            {
              "name": "Display name",
              "visible": true,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "None"
            },
            {
              "name": "Password",
              "visible": true,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "None"
            },
            {
              "name": "Confirm password",
              "visible": true,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "None"
            },
            {
              "name": "Email",
              "visible": true,
              "required": true,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "No verification"
            },
            {
              "name": "Agreement",
              "visible": false,
              "required": false,
              "prompted": false,
              "label": "",
              "placeholder": "",
              "regex": "",
              "rule": "None"
            }
          ],
          "signinItems": [
            {
              "name": "Back button",
              "visible": false,
              "label": "\n\u003cstyle\u003e\n  .back-button {\n      top: 65px;\n      left: 15px;\n      position: absolute;\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Languages",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-languages {\n      top: 55px;\n      right: 5px;\n      position: absolute;\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Logo",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-logo-box {\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Signin methods",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .signin-methods {\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Username",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-username {\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Password",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-password {\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Agreement",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-agreement {\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Forgot password?",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-forget-password {\n    display: inline-flex;\n    justify-content: space-between;\n    width: 320px;\n    margin-bottom: 25px;\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Login button",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-button-box {\n    margin-bottom: 5px;\n  }\n  .login-button {\n    width: 100%;\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Signup link",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .login-signup-link {\n    margin-bottom: 24px;\n    display: flex;\n    justify-content: end;\n}\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "None",
              "isCustom": false
            },
            {
              "name": "Providers",
              "visible": true,
              "label": "\n\u003cstyle\u003e\n  .provider-img {\n      width: 30px;\n      margin: 5px;\n  }\n  .provider-big-img {\n      margin-bottom: 10px;\n  }\n\u003c/style\u003e\n",
              "placeholder": "",
              "rule": "small",
              "isCustom": false
            }
          ],
          "grantTypes": [
            "authorization_code",
            "id_token"
          ],
          "redirectUris": [
            "{{ include "common.endpoint.webAPI" . }}/api/v1/account/casdoor/login/callback"
          ],
          "tokenFormat": "JWT",
          "tokenFields": [],
          "expireInHours": 168,
          "refreshExpireInHours": 168,
          "themeData": {
            "themeType": "lark",
            "colorPrimary": "#1C8B7F",
            "borderRadius": 6,
            "isCompact": false,
            "isEnabled": true
          },
          "footerHtml": "<C2><A9>2025 OpenCSG. All rights reserved.",
          "formCSS": "",
          "formOffset": 2,
          "formSideHtml": "<style>  .left-model{    text-align: center;    padding: 60px;    background-image: url('https://cdn.jsdelivr.net/gh/OpenCSGs/images/background.png');    background-size: cover;    background-position: center;    position: absolute;    transform: none;    width: 100%;    height: 100%;  }  .side-logo {    display: flex;    align-items: center;  }  .side-logo span {    font-family: Montserrat, sans-serif;    font-weight: 900;    font-size: 2.4rem;    line-height: 1.3;    margin-left: 16px;    color: #404040;  }  .img{    max-width: none;    margin: 41px 0 13px;  }</style><div class='left-model'>  <span class='side-logo'> <img src='' alt='' style='width: 120px'>   </span>  <div class='img'>    <img src='' alt='' style='width: 120px'/>  </div></div>",
          "failedSigninLimit": 5,
          "failedSigninFrozenTime": 15
        }
      ],
      "certs": [
        {
          "owner": "admin",
          "name": "csgship-cert",
          "displayName": "CSGShip Cert",
          "scope": "JWT",
          "type": "x509",
          "cryptoAlgorithm": "RS256",
          "bitSize": 4096,
          "expireInYears": 20,
          "certificate": "-----BEGIN CERTIFICATE-----\nMIIE2TCCAsGgAwIBAgIDAeJAMA0GCSqGSIb3DQEBCwUAMCYxDjAMBgNVBAoTBWFk\nbWluMRQwEgYDVQQDDAtjZXJ0X3Vpd3RhaDAeFw0yNTA0MjIwMjQ1NDNaFw00NTA0\nMjIwMjQ1NDNaMCYxDjAMBgNVBAoTBWFkbWluMRQwEgYDVQQDDAtjZXJ0X3Vpd3Rh\naDCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAMbtx+W+pW5PbB99BbQt\nWX0laH9OQ72Hz9P19bDW9L96UlXBniPdePcJKFb6bbJ+TL1GdTOE/bjW71QGc8P3\nwNgqsLk01mrkgh0okbov6UR+C4hOVP+t9S6DIWN0etzyODTlpkWEd9/FU2gVhIRb\nxaHNX0qQXTotzAjs80AFuZnqG3jpF/7SOByE7fFNHXBB7UTPSjVm3EJX3jsGNS6D\n7YtXBZgYDb0Y85pBHAZxbaVp2W49bMBWaUCKLDOiTjKmipJ96N0FKbB5Q0D+vv2e\nNlpdaUQXY9sHtYt8j+Pk4x+61OKfSKYF1nWqO3u33qaMNGiV/L37IBXYeAmceKt6\nVhMG2l50+nG6jVnsLM0j4YnXR3Ry5+K4R8FXeBjcF/fXxbHFulfWUjZg8gz6mPeZ\n0WCMgAXPy7Lk922EMyFV3z6kceO01IbXZj/TSQRfvI7jKrmgO15TGyKJZTgfId3c\nSfCrSDfr2ITu/vPr4AHzF394Mzhy6s35NziYUG49NDBtFigLumQtZoa83h+TX+rD\n4YrBmi5ctFwtcdXfPqtXuVGuqe2X3r+qqk9hUbX0gL000wqD9ZPFNXTAPkAn1J1f\nljqv7Q8fwnmtcBeMMCHcJ6JTt4j5RwPhy4rowdU54pY3xqVLUYvrYXgvDT8Xky7t\nOhaAeL2HIM6rD+wSXKqa9Wp3AgMBAAGjEDAOMAwGA1UdEwEB/wQCMAAwDQYJKoZI\nhvcNAQELBQADggIBAKlrL66aClTcWGvBu/oRTMYRqhUPSNZZ+scoRM0xI/msc8o/\nb4m09kb7O03kgH3TU5elBqEDXPuMqo9JZJkTQoCVSWKEGoWDmz//EH8FyHrM25jr\naOLJE2klHlYTEfYqem4T1TIbyb5Ho5L+ikRdhux+IXb0PrGD9SqRTMfPUnNEs8ws\nSOty+HCStAmEvAI3JRfuu0mEsDGkeiRdq1jQrQs72elVXNAa4ffD3vJOuXQJFTiI\nreEgczTxUgQ2vE0u77/2hB7UPfDGJGx3bOFtQjn59gZ21C6/e4t1DXqnDLaU/so+\n4VuankSYVtTQ+a5Av4c0RP4DJlNpUx4kOEQyJYfSeJ7P8qticHzVVHeHDGl03nMZ\n5pdYrnKnXZOSgRLYp9hANGVdvzx6SMtx0naunUBjdsaKiaCt6q8aHCCCdRsS46gh\nOhDx2dIqHvqHeaiksAHM1+L6gSw7GJ6xFNslG3bAk54vCiDbhYTvmLqyB0ZCXfND\nxueoD47543zpAUfnpn2Dl35vEkV5COh7XIoj766rpHCSef0RBTS/atZn3umjJYoG\ndS+cCRxtXll9qmvND32nl9nE7MIAUndu7daF1Tzd6f11XukRBl34nwxx9/JWfHB3\nLEq+6UmBri7mQdOZd/mwbSAkTlp8J1b4RZ1h+pr1EgaJ0R4YAtYJ6NX7OUnS\n-----END CERTIFICATE-----\n",
          "privateKey": "-----BEGIN RSA PRIVATE KEY-----\n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\n-----END RSA PRIVATE KEY-----\n"
        }
      ],
      {{- $existingSecret := lookup "v1" "Secret" .Release.Namespace (printf "%s-init" $serviceName) }}
      {{- $defaultUser := $service.admin.name | default "root" }}
      {{- $defaultPass := $service.admin.password | default (include "common.randomPassword" $service.name) }}
      {{- $defaultHtpasswd := htpasswd $defaultUser $defaultPass | trimPrefix (printf "%s:" $defaultUser) }}

      {{- $secretPass := "" }}
      {{- $secretHtpasswd := "" }}
      {{- with and $existingSecret $existingSecret.data }}
        {{- $secretHtpasswd := index $existingSecret.data "INIT_ADMIN_HTPASSWD" }}
        {{- if $secretHtpasswd }}
          {{- $defaultHtpasswd = $secretHtpasswd | b64dec }}
        {{- end }}
      {{- end }}
      "users": [
        {
          "owner": "OpenCSG",
          "name": {{ $defaultUser | quote }},
          "password": {{ $defaultHtpasswd | quote }},
          "passwordSalt": "OpenCSG",
          "passwordType": "bcrypt",
          "displayName": {{ $defaultUser | quote }},
          "email": {{ printf "%s.%s" $defaultUser .Values.global.ingress.domain | quote }},
          "type": "normal-user",
          "avatar": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/robot.png",
          "isAdmin": true,
          "signupApplication": "CSGShip"
        }
      ],
      "providers": [
        {
          "owner": "admin",
          "name": "Captcha_Provider",
          "displayName": "Captcha Provider",
          "category": "Captcha",
          "type": "Default"
        },
        {
          "owner": "admin",
          "name": "Email_Provider",
          "displayName": "Email Provider",
          "category": "Email",
          "type": "Default",
          "method": "POST",
          "clientId": "",
          "clientSecret": "",
          "clientId2": "",
          "clientSecret2": "",
          "userMapping":
          {
            "avatarUrl": "avatarUrl",
            "displayName": "displayName",
            "email": "email",
            "id": "id",
            "username": "username"
          },
          "host": "",
          "port": 465,
          "disableSsl": false,
          "title": "OpenCSG Verification Code",
          "content": "\u003c!DOCTYPE html\u003e\n\u003chtml lang=\u0022en\u0022\u003e\n\u003chead\u003e\n\u003cmeta charset=\u0022UTF-8\u0022\u003e\n\u003cmeta name=\u0022viewport\u0022 content=\u0022width=device-width, initial-scale=1.0\u0022\u003e\n\u003ctitle\u003eVerification Code Email\u003c/title\u003e\n\u003cstyle\u003ebody { font-family: Arial, sans-serif; } .email-container { width: 600px; margin: 0 auto; } .header { text-align: center; } .code { font-size: 24px; margin: 20px 0; text-align: center; } .footer { font-size: 12px; text-align: center; margin-top: 50px; } .footer a { color: #000; text-decoration: none; } .center { text-align: center; } .center a { text-decoration: none; color: #1C8B7F; }\u003c/style\u003e\n\u003c/head\u003e\n\u003cbody\u003e\n\u003cdiv class=\u0022email-container\u0022\u003e\n  \u003cdiv class=\u0022header\u0022\u003e\n    \u003cimg src=\u0022https://cdn.jsdelivr.net/gh/OpenCSGs/images/logo.png\u0022 alt=\u0022OpenCSG Logo\u0022 width=\u0022300\u0022\u003e\n  \u003c/div\u003e\n    \u003cp\u003e\u003cstrong\u003e%{user.friendlyName}\u003c/strong\u003e, here is your verification code\u003c/p\u003e\n    \u003cp\u003eUse this code for your transaction. It's valid for 5 minutes\u003c/p\u003e\n    \u003cdiv class=\u0022code\u0022\u003e\n        %s\n    \u003c/div\u003e\n  \u003chr\u003e\n  \u003cp class=\u0022center\u0022\u003e\n    \u003ca href=\u0022https://opencsg.com\u0022 target=\u0022_blank\u0022\u003eOpenCSG Team\u003c/a\u003e\n  \u003c/p\u003e\n\u003c/div\u003e\n\u003c/body\u003e\n\u003c/html\u003e",
          "enableSignAuthnRequest": false
        },
        {{- $webSvc := include "common.service" (dict "service" "web" "global" .) | fromYaml }}
        {{- $issuer := $webSvc.oauth.issuer | default "https://gitlab.example.com" }}
        {
          "owner": "admin",
          "name": "GitLab_Provider",
          "displayName": "GitLab Provider",
          "category": "OAuth",
          "type": "Custom",
          "method": "Normal",
          "clientId": {{ $webSvc.oauth.clientId | default "" | quote }},
          "clientSecret": {{ $webSvc.oauth.clientSecret | default "" | quote }},
          "customAuthUrl": {{ printf "%s/oauth/authorize" $issuer | quote }},
          "customTokenUrl": {{ printf "%s/oauth/token" $issuer | quote }},
          "customUserInfoUrl": {{ printf "%s/api/v4/user" $issuer | quote }},
          "customLogo": "https://cdn.jsdelivr.net/gh/OpenCSGs/images/gitlab_favicon.png",
          "scopes": "read_user openid profile email",
          "userMapping":
          {
            "avatarUrl": "avatar_url",
            "displayName": "name",
            "email": "email",
            "id": "id",
            "username": "username"
          },
          "issuerUrl": {{ $issuer | quote }},
          "providerUrl": {{ $issuer | quote }}
        }
      ]
    }
  {{- range $path, $_ := .Files.Glob "scripts/casdoor/*.sql" }}
  {{ base $path }}: |
  {{- $.Files.Get $path | nindent 4 }}
  {{- end }}
{{- end }}
